#include <string>
#include <catch2/catch.hpp>

#include <pe-parse/parse.h>

#include "peparse_test_paths.h"

using namespace peparse;

static std::string CORKAMI_FILES[] = {@CORKAMI_FILES@};

TEST_CASE( "Corkami PEs smoketest", "[corkami]" ) {
  for (auto path : CORKAMI_FILES) {
    auto pe_filename = path.substr(path.find_last_of("/\\") + 1);
    SECTION(pe_filename) {
      auto *p = ParsePEFromFile(path.c_str());
      if (p == nullptr) {
        FAIL(GetPEErrString() + " at " + GetPEErrLoc());
      }
      SUCCEED();
      DestructParsedPE(p);
    }
  }
}
