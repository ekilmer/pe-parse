#include <gtest/gtest.h>

#include <string>

#include <pe-parse/parse.h>

using namespace peparse;

// Whether the corkami testset has been downloaded
#if @HAS_CORKAMI_PES@

static std::string kCorkamiFiles[] = {@CORKAMI_FILES@};

class CorkamiTestSuite : public testing::TestWithParam<std::string> {};

TEST_P(CorkamiTestSuite, Corkami) {
  std::string path = GetParam();
  auto *p = ParsePEFromFile(path.c_str());
  EXPECT_TRUE(p) << GetPEErrString() << " at " << GetPEErrLoc();
  DestructParsedPE(p);
}

INSTANTIATE_TEST_SUITE_P(CorkamiTests, CorkamiTestSuite,
                         testing::ValuesIn(kCorkamiFiles));
#endif
